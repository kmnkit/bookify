# Bookify - 本おすすめアプリ PRD

## Overview

Bookifyは、ユーザーの居住国や設定した国に基づいて本をおすすめし、読書進捗を管理できるWebアプリケーション。Google Books APIを活用し、パーソナライズされた読書体験を提供する。多言語対応（日本語・英語・韓国語）でグローバルな読書コミュニティを構築する。

## Background

- **Problem statement**: 読書好きなユーザーが自分の国で入手可能な本を効率的に発見し、読書の進捗を一元管理する手段が限られている
- **Current situation**: 既存の読書管理アプリは国別のおすすめ機能が弱く、多言語対応も不十分
- **Opportunity**: 国別レコメンド×進捗管理×ソーシャル機能を統合した、グローバル対応の読書プラットフォームを提供

## Goals and Success Metrics

- **Primary goal**: ユーザーが自国で入手可能な本を発見し、読書習慣を継続できるプラットフォームの構築
- **Success metrics**:
  - 月間アクティブユーザー数（MAU）
  - ユーザーあたりの登録書籍数
  - 読書進捗更新の頻度
  - ユーザーリテンション率（30日後）
  - アフィリエイトリンクCTR・コンバージョン率
  - プレミアム転換率
- **Non-goals**:
  - 電子書籍の販売・配信
  - 書籍の全文閲覧機能
  - リアルタイムチャット機能

## Target Users

- **Primary users**:
  - 読書を習慣化したい幅広い年齢層のユーザー
  - 新しい本を発見したい読書愛好家
  - 読書記録を管理したいユーザー
- **User needs**:
  - 自国で入手可能な本のおすすめが欲しい
  - 複数の本の読書進捗を一元管理したい
  - 他の読書好きとつながりたい
- **User scenarios**:
  1. 日本在住のユーザーが、日本で人気の本をホーム画面で発見し、読みたい本リストに追加する
  2. 韓国語ユーザーが読んでいる本の進捗を50%に更新し、感想メモを残す
  3. 英語圏のユーザーがフォローしている人がいいねした本を見て、新しい本に興味を持つ

## Requirements

### Functional Requirements

**Must Have (P0):**

| ID | 機能 | 説明 |
|----|------|------|
| F-001 | ソーシャルログイン | Google / Apple認証によるアカウント作成・ログイン |
| F-002 | 国設定 | ユーザーの居住国または任意の国を設定 |
| F-003 | 国別おすすめ本表示 | 設定した国に基づくおすすめ本リストの表示 |
| F-004 | 本検索 | Google Books APIを使用した本の検索 |
| F-005 | 読書進捗管理 | 各本の読書進捗（%）を記録・更新 |
| F-006 | いいね機能 | 本にいいねを付ける・解除する |
| F-007 | いいねした本一覧 | 自分がいいねした本の一覧表示 |
| F-008 | 多言語対応 | 日本語・英語・韓国語のUI切り替え |
| F-009 | 本の要約生成 | AIで本の説明を3行に要約して表示 |

**Should Have (P1):**

| ID | 機能 | 説明 |
|----|------|------|
| F-010 | ユーザーフォロー | 他のユーザーをフォロー・アンフォロー |
| F-011 | フォロー中ユーザーのいいね表示 | フォローしているユーザーがいいねした本を表示 |
| F-012 | ユーザープロフィール | プロフィール画像・自己紹介の設定 |
| F-013 | 読書ステータス | 「読みたい」「読書中」「読了」のステータス管理 |
| F-014 | AIパーソナライズレコメンド | いいね・読書履歴からAIがおすすめ本を提案（Pro機能） |

**Could Have (P2):**

| ID | 機能 | 説明 |
|----|------|------|
| F-015 | 読書統計 | 月間・年間の読書冊数やページ数の統計表示 |
| F-016 | 本のレビュー・コメント | 本に対するテキストレビュー機能 |
| F-017 | 通知機能 | フォロワーのアクティビティ通知 |
| F-018 | 本の共有 | SNSへの読書記録シェア |
| F-019 | AI読書アシスタント | チャット形式で本の相談ができる（Pro機能） |

### Non-Functional Requirements

- **Performance**:
  - ページ読み込み時間 3秒以内
  - 同時接続ユーザー1000人以上をサポート
- **Security**:
  - Firebase Authenticationによる安全な認証
  - Firestore Security Rulesによるデータアクセス制御
  - HTTPS通信の強制
- **Compatibility**:
  - モダンブラウザ対応（Chrome, Safari, Firefox, Edge）
  - レスポンシブデザイン（モバイル・タブレット・デスクトップ）
- **Usability**:
  - WCAG 2.1 AA準拠を目標
  - 直感的なUI/UX

## Technical Constraints

- **フロントエンド**: Next.js（App Router）
- **バックエンド/DB**: Firebase（Firestore, Authentication）
- **本データAPI**: Google Books API
- **AI API**: Claude API（Anthropic）
  - 要約生成: claude-3-haiku（低コスト・高速）
  - レコメンド/アシスタント: claude-3-sonnet（高品質）
- **ホスティング**: Vercel（推奨）
- **認証プロバイダー**: Google, Apple

## User Experience

### Key User Flows

**1. 初回登録フロー:**
```
ランディングページ → ソーシャルログイン選択 → 認証 → 国・言語設定 → ホーム画面
```

**2. 本を発見して保存するフロー:**
```
ホーム画面（おすすめ表示） → 本をタップ → 本詳細画面 → いいね or 読書リストに追加
```

**3. 読書進捗更新フロー:**
```
マイライブラリ → 読書中の本を選択 → 進捗スライダーで更新 → 保存
```

**4. ソーシャル機能フロー:**
```
ユーザー検索 or おすすめユーザー → プロフィール表示 → フォロー → フィードでいいね本を確認
```

### UI/UX Considerations

- ダークモード対応
- 本の表紙画像を活かしたビジュアルデザイン
- ボトムナビゲーション（モバイル）でホーム・検索・ライブラリ・プロフィールへ素早くアクセス
- スケルトンローディングによるスムーズな読み込み体験

### Error Handling

- Google Books API エラー時のフォールバック表示
- オフライン時の適切なメッセージ表示
- 認証エラー時の再ログイン誘導

## Dependencies

- **Internal dependencies**: なし（新規プロジェクト）
- **External dependencies**:
  - Google Books API
  - Firebase Authentication
  - Firebase Firestore
  - Vercel（デプロイ）

## Implementation Phases

### Phase 1 (MVP)

コアな読書管理機能を提供し、価値検証を行う。

- ソーシャルログイン（Google / Apple）
- 国設定・言語設定（日本語・英語・韓国語）
- 国別おすすめ本表示
- 本検索機能
- いいね機能
- 読書進捗管理（%表示）
- マイライブラリ（いいねした本・読書中の本）
- **AI本の要約生成**（Claude API）

### Phase 2

ソーシャル機能を追加し、コミュニティ形成を促進。

- ユーザーフォロー機能
- フォロー中ユーザーのいいね本フィード
- ユーザープロフィール編集
- 読書ステータス（読みたい/読書中/読了）
- **AIパーソナライズレコメンド**（Pro機能）

### Phase 3

エンゲージメント向上機能を追加。

- 読書統計ダッシュボード
- 本のレビュー・コメント
- 通知機能
- SNSシェア機能
- **AI読書アシスタント**（Pro機能）

## Monetization Strategy

### 収益モデル概要

Bookifyは**ハイブリッド収益モデル**を採用し、ユーザー体験を損なわずに持続可能な収益を確保する。

```
┌─────────────────────────────────────────────────────────────┐
│                  Bookify 収益構造                            │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐   │
│  │ アフィリエイト  │  │  フリーミアム  │  │    広告収益   │   │
│  │   (主軸収益)   │  │  サブスク     │  │   (補助的)   │   │
│  │    40-50%     │  │   30-40%     │  │   10-20%    │   │
│  └───────────────┘  └───────────────┘  └───────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

### 1. アフィリエイト収益（主軸）

本おすすめアプリとして最も自然なマネタイズ方法。ユーザーが発見した本を購入する際のアフィリエイトリンクから収益を得る。

#### 対象国別アフィリエイトパートナー

| 国 | パートナー | 報酬率 | 備考 |
|----|-----------|--------|------|
| 日本 | Amazon Japan アソシエイト | 3-8% | 最大手、品揃え豊富 |
| 日本 | 楽天ブックス アフィリエイト | 1-5% | 楽天ポイント連携 |
| 韓国 | Coupang Partners | 3-5% | 韓国最大EC |
| 韓国 | Yes24 / 教保文庫 | 2-4% | 書籍専門 |
| 英語圏 | Amazon Associates | 1-4.5% | グローバル対応 |
| 英語圏 | Bookshop.org | 10% | 独立書店支援、ブランド親和性高 |

#### 実装方針

- **本詳細画面**: 「この本を購入」ボタンで各書店へのリンクを表示
- **国別最適化**: ユーザーの設定国に応じて適切なアフィリエイトリンクを自動選択
- **透明性**: アフィリエイトリンクであることを明示（信頼性確保）

#### 収益予測（MAU 10,000人の場合）

```
購入リンクCTR: 8%  →  800クリック/月
コンバージョン率: 4%  →  32購入/月
平均購入額: ¥1,500
報酬率: 5%
月間収益: 32 × ¥1,500 × 5% = ¥2,400/月

※ユーザー増加に伴いスケール
```

---

### 2. フリーミアムモデル（Bookify Pro）

基本機能を無料で提供しつつ、パワーユーザー向けにプレミアム機能を有料で提供。

#### プラン比較

| 機能 | Free | Pro |
|------|:----:|:---:|
| 本の検索・閲覧 | ✅ | ✅ |
| いいね機能 | ✅ | ✅ |
| 読書進捗管理 | 20冊まで | 無制限 |
| 基本おすすめ | ✅ | ✅ |
| AI本の要約生成 | ✅ | ✅ |
| 広告表示 | あり | なし |
| 詳細読書統計 | ❌ | ✅ |
| 読書ゴール・リマインダー | ❌ | ✅ |
| **AIパーソナライズレコメンド** | ❌ | ✅ |
| **AI読書アシスタント** | ❌ | ✅ |
| データエクスポート | ❌ | ✅ |
| カスタムテーマ | ❌ | ✅ |

#### 価格設定

| プラン | 日本 | 韓国 | 英語圏 |
|--------|------|------|--------|
| 月額 | ¥500 | ₩5,900 | $4.99 |
| 年額 | ¥4,000 | ₩47,000 | $39.99 |
| 割引率 | 33%OFF | 33%OFF | 33%OFF |

#### 収益予測（MAU 10,000人、転換率3%の場合）

```
Pro会員: 300人
月額会員 (60%): 180人 × ¥500 = ¥90,000
年額会員 (40%): 120人 × ¥333/月 = ¥40,000
月間収益: ¥130,000/月
```

---

### 3. 広告収益（補助的）

ユーザー体験を損なわない範囲で、控えめな広告を導入。

#### 広告タイプ

| タイプ | 配置 | 対象 | 備考 |
|--------|------|------|------|
| バナー広告 | フッター | Freeユーザーのみ | 常時表示、控えめ |
| ネイティブ広告 | おすすめリスト内 | Freeユーザーのみ | 「スポンサード」明記 |
| 新刊プロモーション | ホーム画面上部 | 全ユーザー | 出版社からの広告 |

#### 実装方針

- **Google AdSense** をベースに、読書関連広告を優先
- **Pro会員は完全広告非表示**（プレミアム価値の一つ）
- **広告頻度制限**: おすすめ10冊につき広告1件以下

#### 収益予測（MAU 10,000人の場合）

```
Freeユーザー: 9,700人
広告表示回数: 50,000/月
eCPM: $2.00
月間収益: $100 ≒ ¥15,000/月
```

---

### マネタイズ導入フェーズ

| Phase | 収益施策 | 目的 |
|-------|----------|------|
| **Phase 1 (MVP)** | なし（基盤構築のみ） | ユーザー獲得に集中 |
| **Phase 2** | アフィリエイトリンク導入 | 初期収益確保、自然なUX |
| **Phase 3** | 広告導入 + Proプラン開始 | 収益多角化 |

---

### 収益予測サマリー（Phase 3完了時、MAU 10,000人）

| 収益源 | 月間収益（予測） | 構成比 |
|--------|-----------------|--------|
| アフィリエイト | ¥50,000 - ¥150,000 | 30-40% |
| Proサブスクリプション | ¥100,000 - ¥200,000 | 40-50% |
| 広告 | ¥15,000 - ¥50,000 | 10-20% |
| **合計** | **¥165,000 - ¥400,000** | 100% |

---

### リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| Google Books API商用利用制限 | 収益化自体が困難になる可能性 | 事前にTerms of Service確認 |
| アフィリエイトプログラム非承認 | 主要収益源の喪失 | 複数パートナーに申請、代替書店を確保 |
| 低い転換率 | Pro収益が想定以下 | 無料→Proの価値差を明確化 |
| 広告によるUX悪化 | ユーザー離脱 | 広告頻度制限、フィードバック監視 |
| App Store課金手数料（将来） | 収益の15-30%減 | Web課金を優先、年額プラン推奨 |

---

### KPI（マネタイズ関連）

| 指標 | Phase 2目標 | Phase 3目標 |
|------|-------------|-------------|
| アフィリエイトCTR | 5% | 8% |
| アフィリエイトCVR | 2% | 4% |
| Pro転換率 | - | 3% |
| 広告eCPM | - | $2.00 |
| ARPU（全ユーザー平均） | ¥5/月 | ¥30/月 |

## AI Features

### 概要

BookifyはClaude API（Anthropic）を活用し、3つのAI機能を提供する。

| 機能 | モデル | Phase | 対象 |
|------|--------|-------|------|
| 本の要約生成 | claude-3-haiku | Phase 1 | 全ユーザー |
| AIパーソナライズレコメンド | claude-3-sonnet | Phase 2 | Pro |
| AI読書アシスタント | claude-3-sonnet | Phase 3 | Pro |

---

### 1. 本の要約生成（AI Book Summary）

Google Books APIから取得した本の説明文をAIで3行に要約し、ユーザーが素早く本の内容を把握できるようにする。

**仕様:**
- **入力**: Google Books APIの`description`フィールド（最大5000文字）
- **出力**: 3行の日本語/英語/韓国語要約
- **モデル**: claude-3-haiku（低コスト・高速）
- **キャッシュ**: Firestoreに要約結果をキャッシュ（同じ本の再生成を防ぐ）

**ユーザーフロー:**
```
本詳細画面 → 「AI要約」ボタン → ローディング → 3行要約表示
```

**コスト試算（MAU 10,000人）:**
```
月間要約リクエスト: 50,000回（1ユーザー5回）
平均入力トークン: 500
平均出力トークン: 100
Haiku料金: $0.25/1M input, $1.25/1M output
月間コスト: (50,000 × 500 × $0.25/1M) + (50,000 × 100 × $1.25/1M)
         = $6.25 + $6.25 = $12.50/月
```

---

### 2. AIパーソナライズレコメンド（AI Personalized Recommendations）

ユーザーのいいね履歴・読書傾向をAIが分析し、パーソナライズされた本をおすすめする。

**仕様:**
- **入力**:
  - ユーザーのいいねした本リスト（タイトル、著者、ジャンル）
  - 読書履歴（読了本、読書中の本）
- **出力**: おすすめジャンル・著者・キーワード → Google Books APIで検索
- **モデル**: claude-3-sonnet（高品質な分析）
- **更新頻度**: 週1回または手動更新

**ユーザーフロー:**
```
ホーム画面 → 「あなたへのおすすめ」セクション → AIが選んだ本リスト
```

**コスト試算（Pro会員300人）:**
```
月間レコメンド生成: 1,200回（週1回 × 4週）
平均入力トークン: 2,000
平均出力トークン: 500
Sonnet料金: $3/1M input, $15/1M output
月間コスト: (1,200 × 2,000 × $3/1M) + (1,200 × 500 × $15/1M)
         = $7.20 + $9.00 = $16.20/月
```

---

### 3. AI読書アシスタント（AI Reading Assistant）

チャット形式で本についての相談ができる。「次何読む？」「この本について教えて」などの質問に回答。

**仕様:**
- **入力**: ユーザーの質問 + 読書履歴コンテキスト
- **出力**: 自然言語での回答・本のおすすめ
- **モデル**: claude-3-sonnet
- **制限**: Pro会員のみ、月間50メッセージまで

**ユーザーフロー:**
```
プロフィール画面 → 「AI読書アシスタント」 → チャットUI → 質問入力 → AI回答
```

**サンプル会話:**
```
ユーザー: 最近ミステリーばかり読んでるけど、違うジャンルも試したい
AI: あなたの読書履歴を見ると、東野圭吾や宮部みゆきの作品が多いですね。
    論理的な展開が好きなようなので、SF小説はいかがでしょう？
    「三体」や「プロジェクト・ヘイル・メアリー」がおすすめです。
```

**コスト試算（Pro会員300人）:**
```
月間チャットメッセージ: 6,000回（1ユーザー20メッセージ）
平均入力トークン: 1,500（履歴コンテキスト含む）
平均出力トークン: 300
Sonnet料金: $3/1M input, $15/1M output
月間コスト: (6,000 × 1,500 × $3/1M) + (6,000 × 300 × $15/1M)
         = $27.00 + $27.00 = $54.00/月
```

---

### AI機能 コスト合計（MAU 10,000人、Pro 300人）

| 機能 | 月間コスト |
|------|-----------|
| 本の要約生成 | $12.50 |
| AIパーソナライズレコメンド | $16.20 |
| AI読書アシスタント | $54.00 |
| **合計** | **$82.70/月** |

Pro会員収益（¥130,000/月 ≒ $870）に対してAIコストは約10%。十分に持続可能。

---

### AI機能 技術実装方針

**API呼び出し:**
- Next.js API Routes（Route Handlers）経由でClaude APIを呼び出し
- クライアントからは直接呼び出さない（APIキー保護）

**レート制限:**
- 要約: 1ユーザー10回/日
- レコメンド: 1ユーザー4回/月
- アシスタント: Pro会員50メッセージ/月

**キャッシュ戦略:**
- 要約結果: Firestoreに永続キャッシュ
- レコメンド結果: 7日間キャッシュ

**エラーハンドリング:**
- API障害時: 「現在利用できません」メッセージ + 再試行ボタン
- レート制限超過: 「本日の利用上限に達しました」

---

### AI機能 セキュリティ・DDoS対策

AI APIは従量課金のため、DDoS攻撃による費用急増を防ぐ対策が必須。

#### 1. 認証・認可

| 対策 | 説明 |
|------|------|
| 認証必須 | AI機能は全てログインユーザーのみ利用可能 |
| Firebase Auth検証 | API Route側でIDトークンを必ず検証 |
| Pro機能チェック | レコメンド・アシスタントはPro会員のみ |

#### 2. レート制限（多層防御）

| レイヤー | 制限 | 実装 |
|----------|------|------|
| **グローバル** | 1,000リクエスト/分（全体） | Vercel Edge Middleware |
| **IPベース** | 100リクエスト/分/IP | Vercel Edge Middleware |
| **ユーザーベース** | 要約10回/日、アシスタント50回/月 | Firestore カウンター |
| **バースト防止** | 同一ユーザー5リクエスト/分 | Firestore + Redis |

#### 3. コスト上限（サーキットブレーカー）

```
月間AI API予算: $200
├── 警告閾値 (80%): $160 → Slack通知
├── 制限閾値 (90%): $180 → 新規リクエスト制限
└── 停止閾値 (100%): $200 → AI機能一時停止
```

**実装方法:**
- Claude API使用量をFirestoreで日次集計
- 閾値超過時はCloud Functionsでアラート送信
- 緊急時はFeature Flagで即座にAI機能を無効化

#### 4. リクエスト検証

| 対策 | 説明 |
|------|------|
| 入力サイズ制限 | 要約: 5,000文字、アシスタント: 1,000文字 |
| 入力サニタイズ | プロンプトインジェクション対策 |
| Bot検出 | 不審なパターン検出（同一リクエスト連発等） |
| CAPTCHA | 異常検知時にreCAPTCHA v3を表示 |

#### 5. インフラ対策

| 対策 | 説明 |
|------|------|
| Vercel WAF | 基本的なDDoS防御（標準搭載） |
| Cloudflare（オプション） | 高度なBot対策、レート制限 |
| API Route分離 | AI専用エンドポイントを分離し監視強化 |

#### 6. 監視・アラート

| 監視項目 | アラート条件 |
|----------|-------------|
| API呼び出し数 | 通常の3倍超過 |
| エラー率 | 5%超過 |
| レスポンス時間 | 平均5秒超過 |
| コスト | 日次予算超過 |

**通知先:** Slack / メール

#### 実装優先度

| Phase | 対策 |
|-------|------|
| **Phase 1 (MVP)** | 認証必須、ユーザーレート制限、入力サイズ制限 |
| **Phase 2** | IPレート制限、コスト監視、アラート |
| **Phase 3** | サーキットブレーカー、Bot検出、CAPTCHA |

## Data Models

### Users Collection
```
users/{userId}
├── displayName: string
├── email: string
├── photoURL: string
├── country: string (ISO 3166-1 alpha-2)
├── language: "ja" | "en" | "ko"
├── createdAt: timestamp
└── updatedAt: timestamp
```

### Books Collection (User's Library)
```
users/{userId}/books/{bookId}
├── googleBooksId: string
├── title: string
├── authors: string[]
├── thumbnail: string
├── progress: number (0-100)
├── status: "want_to_read" | "reading" | "finished"
├── liked: boolean
├── likedAt: timestamp | null
├── createdAt: timestamp
└── updatedAt: timestamp
```

### Follows Collection
```
users/{userId}/following/{targetUserId}
├── followedAt: timestamp

users/{userId}/followers/{followerUserId}
├── followedAt: timestamp
```

### Likes Collection (for aggregation)
```
likes/{likeId}
├── userId: string
├── bookId: string (googleBooksId)
├── bookTitle: string
├── bookThumbnail: string
├── createdAt: timestamp
```

## Open Questions

- Google Books APIのレート制限への対応策（キャッシュ戦略）
- 国別おすすめのアルゴリズム詳細（Google Books APIのパラメータ活用方法）
- ユーザー削除時のデータ処理ポリシー
- 将来的なモバイルアプリ（React Native / Flutter）への展開可否
- Claude APIのコスト最適化（バッチ処理、キャッシュ活用）
- AI要約の多言語品質検証（日本語・英語・韓国語それぞれの精度）
- AIアシスタントの会話履歴保存ポリシー（プライバシー考慮）
- AI機能の障害時フォールバック戦略

## Appendix

### Google Books API Reference
- https://developers.google.com/books/docs/v1/using

### Firebase Documentation
- https://firebase.google.com/docs

### 多言語対応
- next-intl または next-i18next の採用を検討
